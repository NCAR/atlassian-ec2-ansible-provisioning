#!/bin/bash

#
# FIXME datestamp backup?
# home directory + s3 attachments/avatars
#

mycnf=$(/usr/local/bin/create_mycnf.sh)

/usr/bin/mysqlsh --defaults-file=$mycnf <<EOF

util.dumpSchemas(
  [ "{{ atl_jdbc_db_name }}" ],
  "{{ atl_proxy_name }}/backups/{{ atl_jdbc_db_name }}",
  {
    s3BucketName: "{{ atl_backup_bucket }}",
    compatibility: [ "strip_definers" ]
  }
)

EOF

rm $mycnf



#  util.dumpInstance("test",{s3bucketName: "Bucket001", threads: 4, 
#        compatibility: ["strip_restricted_grants", "strip_definers", "ignore_missing_pks"]})
#
