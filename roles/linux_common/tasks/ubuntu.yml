---

- name: Install common Ubuntu support packages
  ansible.builtin.apt:
    name:
      - fontconfig
      - git
      - libxml2-utils
      - pwgen
      - xmlstarlet

# - name: Add cloud-init envvars to root shell via .bashrc
#   ansible.builtin.lineinfile:
#     path: /root/.bashrc
#     line: tmpfile=$(mktemp); grep export /var/lib/cloud/instance/user-data.txt > $tmpfile; source $tmpfile; rm $tmpfile

# - name: Add JAVA_HOME to .bashrc
#   ansible.builtin.lineinfile:
#     path: /root/.bashrc
#     line: export JAVA_HOME=$(java -XshowSettings:properties -version 2>&1 | perl -ne '/java\.home\s*=\s*(.*)/ && print $1')
    
- name: Customizations for root .bashrc
  ansible.builtin.blockinfile:
     path: /root/.bashrc
     append_newline: true
     prepend_newline: true
     marker: "### {mark} ANSIBLE MANAGED BLOCK ###"
     block: |
       # Source user data env vars into environment for subsequent ansible runs
       tmpfile=$(mktemp); grep export /var/lib/cloud/instance/user-data.txt > $tmpfile; source $tmpfile; rm $tmpfile
       # Get java home
       export JAVA_HOME=$(java -XshowSettings:properties -version 2>&1 | perl -ne '/java\.home\s*=\s*(.*)/ && print $1')
       
